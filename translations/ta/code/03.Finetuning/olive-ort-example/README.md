# Olive роорпВро▓роорпН Phi3-роР роиройрпНро▒ро╛роХродрпН родроХрпБро╡ро╛роХрпНроХрпБродро▓рпН

роЗроирпНрод роЙродро╛ро░рогродрпНродро┐ро▓рпН, Olive-роР рокропройрпНрокроЯрпБродрпНродро┐ роирпАроЩрпНроХро│рпН роЪрпЖропрпНропрокрпНрокрпЛроХро┐ро▒рпАро░рпНроХро│рпН:

1. Sad, Joy, Fear, Surprise роЖроХро┐ропро╡ро▒рпНро▒ро┐ро▓рпН ро╡ро╛роХрпНроХро┐ропроЩрпНроХро│рпИ ро╡роХрпИрокрпНрокроЯрпБродрпНрод LoRA adapter-роР роиройрпНро▒ро╛роХродрпН родроХрпБро╡ро╛роХрпНроХрпБродро▓рпН.
1. Adapter роОроЯрпИроХро│рпИроХрпН роЕроЯро┐рокрпНрокроЯрпИ рооро╛родро┐ро░ро┐ропро┐ро▓рпН роЗрогрпИродрпНродро▓рпН.
1. рооро╛родро┐ро░ро┐ропрпИ `int4`-роЖроХ роорпЗроорпНрокроЯрпБродрпНродро┐ рооро▒рпНро▒рпБроорпН роЕро│ро╡рпАроЯрпБ роЪрпЖропрпНродро▓рпН.

роорпЗро▓рпБроорпН, ONNX Runtime (ORT) Generate API-ропрпИ рокропройрпНрокроЯрпБродрпНродро┐ роиройрпНро▒ро╛роХродрпН родроХрпБро╡ро╛роХрпНроХрокрпНрокроЯрпНроЯ рооро╛родро┐ро░ро┐ропрпИ inference роЪрпЖропрпНро╡родрпБ роОрокрпНрокроЯро┐ роОройрпНрокродрпИ роЙроЩрпНроХро│рпБроХрпНроХрпБроХрпН роХро╛роЯрпНроЯрпБро╡рпЛроорпН.

> **тЪая╕П Fine-tuning роЪрпЖропрпНроп, роЙроЩрпНроХро│рпБроХрпНроХрпБ роПро▒рпНро▒ GPU роХро┐роЯрпИроХрпНроХ ро╡рпЗрогрпНроЯрпБроорпН - роЙродро╛ро░рогрооро╛роХ, A10, V100, A100.**

## ЁЯТ╛ роиро┐ро▒рпБро╡ро▓рпН

рокрпБродро┐роп Python роорпЖропрпНроиро┐роХро░рпН роЪрпВро┤ро▓рпИ роЙро░рпБро╡ро╛роХрпНроХро╡рпБроорпН (роЙродро╛ро░рогрооро╛роХ, `conda` рокропройрпНрокроЯрпБродрпНродро┐):

```bash
conda create -n olive-ai python=3.11
conda activate olive-ai
```

роЕроЯрпБродрпНродродро╛роХ, Olive рооро▒рпНро▒рпБроорпН fine-tuning ро╡рпЗро▓рпИрокрпНрокро╛роЯрпБроХро│рпБроХрпНроХро╛рой роЪро╛ро░рпНрокрпБроХро│рпИ роиро┐ро▒рпБро╡ро╡рпБроорпН:

```bash
cd Phi-3CookBook/code/04.Finetuning/olive-ort-example
pip install olive-ai[gpu]
pip install -r requirements.txt
```

## ЁЯзк Olive роорпВро▓роорпН Phi3-роР роиройрпНро▒ро╛роХродрпН родроХрпБро╡ро╛роХрпНроХрпБродро▓рпН
[Olive configuration file](../../../../../code/03.Finetuning/olive-ort-example/phrase-classification.json) *workflow* роХрпКрогрпНроЯрпБро│рпНро│родрпБ, роЗродро┐ро▓рпН рокро┐ройрпНро╡ро░рпБроорпН *passes* роЙро│рпНро│рой:

Phi3 -> LoRA -> MergeAdapterWeights -> ModelBuilder

роЗроирпНрод workflow-ройрпН роорпБроХрпНроХро┐роп роЕроорпНроЪроЩрпНроХро│рпН:

1. [dataset/data-classification.json](../../../../../code/03.Finetuning/olive-ort-example/dataset/dataset-classification.json) родро░ро╡рпИроХрпН роХрпКрогрпНроЯрпБ Phi3-роР (150 рокроЯро┐роХро│рпН, роирпАроЩрпНроХро│рпН рооро╛ро▒рпНро▒ро▓ро╛роорпН) роиройрпНро▒ро╛роХродрпН родроХрпБро╡ро╛роХрпНроХрпБродро▓рпН.
1. LoRA adapter роОроЯрпИроХро│рпИ роЕроЯро┐рокрпНрокроЯрпИ рооро╛родро┐ро░ро┐ропро┐ро▓рпН роЗрогрпИродрпНродро▓рпН. роЗродройро╛ро▓рпН ONNX ро╡роЯро┐ро╡родрпНродро┐ро▓рпН роТро░рпБ рооро╛родро┐ро░ро┐ роХро▓рпИрокрпНрокрпКро░рпБро│рпН роХро┐роЯрпИроХрпНроХрпБроорпН.
1. Model Builder ONNX runtime-роХрпНроХрпБ рооро╛родро┐ро░ро┐ропрпИ роорпЗроорпНрокроЯрпБродрпНродрпБроорпН *рооро▒рпНро▒рпБроорпН* рооро╛родро┐ро░ро┐ропрпИ `int4`-роЖроХ роЕро│ро╡рпАроЯрпБ роЪрпЖропрпНропрпБроорпН.

роЗроирпНрод workflow-роР роЗропроХрпНроХ, роХрпАро┤рпЗ роЙро│рпНро│родрпИ роЗропроХрпНроХро╡рпБроорпН:

```bash
olive run --config phrase-classification.json
```

Olive роорпБроЯро┐роирпНродро╡рпБроЯройрпН, роЙроЩрпНроХро│рпН `int4` роиройрпНро▒ро╛роХродрпН родроХрпБро╡ро╛роХрпНроХрокрпНрокроЯрпНроЯ Phi3 рооро╛родро┐ро░ро┐ роХро┐роЯрпИроХрпНроХрпБроорпН: `code/04.Finetuning/olive-ort-example/models/lora-merge-mb/gpu-cuda_model`.

## ЁЯзСтАНЁЯТ╗ роЙроЩрпНроХро│рпН рокропройрпНрокро╛роЯрпНроЯро┐ро▓рпН роиройрпНро▒ро╛роХродрпН родроХрпБро╡ро╛роХрпНроХрокрпНрокроЯрпНроЯ Phi3-роР роТро░рпБроЩрпНроХро┐рогрпИродрпНродро▓рпН 

роЕрокрпНрокро┐ро│ро┐роХрпНроХрпЗро╖ройрпИ роЗропроХрпНроХ:

```bash
python app/app.py --phrase "cricket is a wonderful sport!" --model-path models/lora-merge-mb/gpu-cuda_model
```

роЗроирпНрод рокродро┐ро▓рпН ро╡ро╛роХрпНроХро┐ропродрпНродро┐ройрпН ро╡роХрпИрокрпНрокроЯрпБродрпНродро▓рпБроХрпНроХро╛рой роТро░рпБ роЪрпКро▓рпН (Sad/Joy/Fear/Surprise) роЖроХ роЗро░рпБроХрпНроХ ро╡рпЗрогрпНроЯрпБроорпН.

---

**роЕро▒ро┐ро╡ро┐рокрпНрокрпБ**:  
роЗроирпНрод роЖро╡рогроорпН [Co-op Translator](https://github.com/Azure/co-op-translator) роОройрпНро▒ AI роорпКро┤ро┐рокрпЖропро░рпНрокрпНрокрпБ роЪрпЗро╡рпИропрпИ рокропройрпНрокроЯрпБродрпНродро┐ роорпКро┤ро┐рокрпЖропро░рпНроХрпНроХрокрпНрокроЯрпНроЯрпБро│рпНро│родрпБ. роиро╛роЩрпНроХро│рпН родрпБро▓рпНро▓ро┐ропродрпНродро┐ро▒рпНроХро╛роХ роорпБропро▒рпНроЪро┐роХрпНроХро┐ро▒рпЛроорпН, роЖройро╛ро▓рпН родро╛ройро┐ропроЩрпНроХро┐ роорпКро┤ро┐рокрпЖропро░рпНрокрпНрокрпБроХро│ро┐ро▓рпН рокро┐ро┤рпИроХро│рпН роЕро▓рпНро▓родрпБ родро╡ро▒рпБроХро│рпН роЗро░рпБроХрпНроХроХрпНроХрпВроЯрпБроорпН роОройрпНрокродрпИ родропро╡рпБроЪрпЖропрпНродрпБ роХро╡ройродрпНродро┐ро▓рпН роХрпКро│рпНро│ро╡рпБроорпН. роЕродройрпН роЪрпКроирпНрод роорпКро┤ро┐ропро┐ро▓рпН роЙро│рпНро│ роорпВро▓ роЖро╡рогроорпН роЕродро┐роХро╛ро░рокрпНрокрпВро░рпНро╡ роЖродро╛ро░рооро╛роХ роХро░рпБродрокрпНрокроЯ ро╡рпЗрогрпНроЯрпБроорпН. роорпБроХрпНроХро┐ропрооро╛рой родроХро╡ро▓рпНроХро│рпБроХрпНроХрпБ, родрпКро┤ро┐ро▓рпНроорпБро▒рпИ рооройро┐род роорпКро┤ро┐рокрпЖропро░рпНрокрпНрокрпБ рокро░ро┐роирпНродрпБро░рпИроХрпНроХрокрпНрокроЯрпБроХро┐ро▒родрпБ. роЗроирпНрод роорпКро┤ро┐рокрпЖропро░рпНрокрпНрокрпИрокрпН рокропройрпНрокроЯрпБродрпНродрпБро╡родро╛ро▓рпН роПро▒рпНрокроЯрпБроорпН роОроирпНрод родро╡ро▒ро╛рой рокрпБро░ро┐родро▓рпНроХро│рпБроХрпНроХрпБроорпН роЕро▓рпНро▓родрпБ родро╡ро▒ро╛рой ро╡ро┐ро│роХрпНроХроЩрпНроХро│рпБроХрпНроХрпБроорпН роиро╛роЩрпНроХро│рпН рокрпКро▒рпБрокрпНрокро▓рпНро▓.