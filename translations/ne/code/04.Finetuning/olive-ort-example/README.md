# Olive рдкреНрд░рдпреЛрдЧ рдЧрд░реЗрд░ Phi3 рд▓рд╛рдИ Fine-tune рдЧрд░реНрдиреЗ

рдпрд╕ рдЙрджрд╛рд╣рд░рдгрдорд╛ рддрдкрд╛рдИрдВрд▓реЗ Olive рдкреНрд░рдпреЛрдЧ рдЧрд░реЗрд░:

1. LoRA рдПрдбрд╛рдкреНрдЯрд░рд▓рд╛рдИ Sad, Joy, Fear, Surprise рдорд╛ рд╡рд╛рдХреНрдпрд╛рдВрд╢ рд╡рд░реНрдЧреАрдХрд░рдг рдЧрд░реНрди Fine-tune рдЧрд░реНрдиреЗред
1. рдПрдбрд╛рдкреНрдЯрд░рдХрд╛ рддреМрд▓рд╣рд░реВрд▓рд╛рдИ рдЖрдзрд╛рд░ рдореЛрдбреЗрд▓рдорд╛ рдорд░реНрдЬ рдЧрд░реНрдиреЗред
1. рдореЛрдбреЗрд▓рд▓рд╛рдИ `int4` рдорд╛ рдЕрдкреНрдЯрд┐рдорд╛рдЗрдЬ рд░ рдХреНрд╡рд╛рдиреНрдЯрд╛рдЗрдЬ рдЧрд░реНрдиреЗред

рд╣рд╛рдореАрд▓реЗ ONNX Runtime (ORT) Generate API рдкреНрд░рдпреЛрдЧ рдЧрд░реЗрд░ Fine-tuned рдореЛрдбреЗрд▓ рдХрд╕рд░реА inference рдЧрд░реНрдиреЗ рдкрдирд┐ рджреЗрдЦрд╛рдЙрдиреЗрдЫреМрдВред

> **тЪая╕П Fine-tuning рдХреЛ рд▓рд╛рдЧрд┐, рддрдкрд╛рдИрдВрд▓рд╛рдИ рдЙрдкрдпреБрдХреНрдд GPU рдЖрд╡рд╢реНрдпрдХ рдкрд░реНрдЫ - рдЬрд╕реНрддреИ A10, V100, A100ред**

## ЁЯТ╛ рдЗрдиреНрд╕реНрдЯрд▓ рдЧрд░реНрдиреЗ

рдирдпрд╛рдБ Python рднрд░реНрдЪреБрдЕрд▓ рд╡рд╛рддрд╛рд╡рд░рдг рдмрдирд╛рдЙрдиреБрд╣реЛрд╕реН (рдЬрд╕реНрддреИ `conda` рдкреНрд░рдпреЛрдЧ рдЧрд░реЗрд░):

```bash
conda create -n olive-ai python=3.11
conda activate olive-ai
```

рддреНрдпрд╕рдкрдЫрд┐, Olive рд░ Fine-tuning workflow рдХрд╛ рд▓рд╛рдЧрд┐ рдЖрд╡рд╢реНрдпрдХ рдирд┐рд░реНрднрд░рддрд╛ рдЗрдиреНрд╕реНрдЯрд▓ рдЧрд░реНрдиреБрд╣реЛрд╕реН:

```bash
cd Phi-3CookBook/code/04.Finetuning/olive-ort-example
pip install olive-ai[gpu]
pip install -r requirements.txt
```

## ЁЯзк Olive рдкреНрд░рдпреЛрдЧ рдЧрд░реЗрд░ Phi3 рд▓рд╛рдИ Fine-tune рдЧрд░реНрдиреЗ
[Olive рдХрдиреНрдлрд┐рдЧрд░реЗрд╕рди рдлрд╛рдЗрд▓](../../../../../code/04.Finetuning/olive-ort-example/phrase-classification.json) рдорд╛ рдирд┐рдореНрди *workflow* рд░ *passes* рдЫрдиреН:

Phi3 -> LoRA -> MergeAdapterWeights -> ModelBuilder

рдЙрдЪреНрдЪ рд╕реНрддрд░рдорд╛, рдпреЛ workflow рд▓реЗ:

1. Phi3 рд▓рд╛рдИ 150 рд╕реНрдЯреЗрдкреНрд╕ (рддрдкрд╛рдИрдВрд▓реЗ рдкрд░рд┐рд╡рд░реНрддрди рдЧрд░реНрди рд╕рдХреНрдиреБрд╣реБрдиреНрдЫ) рдХреЛ рд▓рд╛рдЧрд┐ [dataset/data-classification.json](../../../../../code/04.Finetuning/olive-ort-example/dataset/dataset-classification.json) рдбрд╛рдЯрд╛рд╕рдБрдЧ Fine-tune рдЧрд░реНрдиреЗред
1. LoRA рдПрдбрд╛рдкреНрдЯрд░рдХрд╛ рддреМрд▓рд╣рд░реВрд▓рд╛рдИ рдЖрдзрд╛рд░ рдореЛрдбреЗрд▓рдорд╛ рдорд░реНрдЬ рдЧрд░реНрдиреЗред рдпрд╕рд▓реЗ ONNX рдлрд░реНрдореНрдпрд╛рдЯрдорд╛ рдПрдХрд▓ рдореЛрдбреЗрд▓ рдЖрд░реНрдЯрд┐рдлреНрдпрд╛рдХреНрдЯ рджрд┐рдиреЗрдЫред
1. Model Builder рд▓реЗ рдореЛрдбреЗрд▓рд▓рд╛рдИ ONNX runtime рдХрд╛ рд▓рд╛рдЧрд┐ рдЕрдкреНрдЯрд┐рдорд╛рдЗрдЬ рдЧрд░реНрдиреЗ *рд░* рдореЛрдбреЗрд▓рд▓рд╛рдИ `int4` рдорд╛ рдХреНрд╡рд╛рдиреНрдЯрд╛рдЗрдЬ рдЧрд░реНрдиреЗрдЫред

Workflow рдЪрд▓рд╛рдЙрди:

```bash
olive run --config phrase-classification.json
```

Olive рдкреВрд░рд╛ рднрдПрдкрдЫрд┐, рддрдкрд╛рдИрдВрдХреЛ рдЕрдкреНрдЯрд┐рдорд╛рдЗрдЬ рдЧрд░рд┐рдПрдХреЛ `int4` Fine-tuned Phi3 рдореЛрдбреЗрд▓ рдпреЛ рд╕реНрдерд╛рдирдорд╛ рдЙрдкрд▓рдмреНрдз рд╣реБрдиреЗрдЫ: `code/04.Finetuning/olive-ort-example/models/lora-merge-mb/gpu-cuda_model`ред

## ЁЯзСтАНЁЯТ╗ Fine-tuned Phi3 рд▓рд╛рдИ рддрдкрд╛рдИрдВрдХреЛ рдПрдкреНрд▓рд┐рдХреЗрд╢рдирдорд╛ рд╕рдорд╛рд╡реЗрд╢ рдЧрд░реНрдиреЗ

рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдЪрд▓рд╛рдЙрди:

```bash
python app/app.py --phrase "cricket is a wonderful sport!" --model-path models/lora-merge-mb/gpu-cuda_model
```

рдпреЛ рдкреНрд░рддрд┐рдХреНрд░рд┐рдпрд╛ рд╡рд╛рдХреНрдпрд╛рдВрд╢рдХреЛ рдПрдХрд▓ рд╢рдмреНрдж рд╡рд░реНрдЧреАрдХрд░рдг рд╣реБрдиреБрдкрд░реНрдЫ (Sad/Joy/Fear/Surprise)ред

**рдЕрд╕реНрд╡реАрдХрд░рдг**:  
рдпреЛ рджрд╕реНрддрд╛рд╡реЗрдЬ AI рдЕрдиреБрд╡рд╛рдж рд╕реЗрд╡рд╛ [Co-op Translator](https://github.com/Azure/co-op-translator) рдкреНрд░рдпреЛрдЧ рдЧрд░реА рдЕрдиреБрд╡рд╛рдж рдЧрд░рд┐рдПрдХреЛ рд╣реЛред рд╣рд╛рдореА рд╢реБрджреНрдзрддрд╛рдХрд╛ рд▓рд╛рдЧрд┐ рдкреНрд░рдпрд╛рд╕рд░рдд рдЫреМрдВ, рддрд░ рдХреГрдкрдпрд╛ рдзреНрдпрд╛рди рджрд┐рдиреБрд╣реЛрд╕реН рдХрд┐ рд╕реНрд╡рдЪрд╛рд▓рд┐рдд рдЕрдиреБрд╡рд╛рджрдорд╛ рддреНрд░реБрдЯрд┐ рд╡рд╛ рдЕрд╢реБрджреНрдзрддрд╛ рд╣реБрдирд╕рдХреНрдЫред рдореВрд▓ рджрд╕реНрддрд╛рд╡реЗрдЬ рдпрд╕рдХреЛ рдореВрд▓ рднрд╛рд╖рд╛рдорд╛ рдиреИ рдЕрдзрд┐рдХрд╛рд░рд┐рдХ рд╕реНрд░реЛрдд рдорд╛рдирд┐рдиреБрдкрд░реНрдЫред рдорд╣рддреНрд╡рдкреВрд░реНрдг рдЬрд╛рдирдХрд╛рд░реАрдХрд╛ рд▓рд╛рдЧрд┐ рд╡реНрдпрд╛рд╡рд╕рд╛рдпрд┐рдХ рдорд╛рдирд╡ рдЕрдиреБрд╡рд╛рдж рд╕рд┐рдлрд╛рд░рд┐рд╕ рдЧрд░рд┐рдиреНрдЫред рдпрд╕ рдЕрдиреБрд╡рд╛рджрдХреЛ рдкреНрд░рдпреЛрдЧрдмрд╛рдЯ рдЙрддреНрдкрдиреНрди рдХреБрдиреИ рдкрдирд┐ рдЧрд▓рддрдлрд╣рдореА рд╡рд╛ рдЧрд▓рдд рд╡реНрдпрд╛рдЦреНрдпрд╛рдХрд╛ рд▓рд╛рдЧрд┐ рд╣рд╛рдореА рдЬрд┐рдореНрдореЗрд╡рд╛рд░ рдЫреИрдиреМрдВред