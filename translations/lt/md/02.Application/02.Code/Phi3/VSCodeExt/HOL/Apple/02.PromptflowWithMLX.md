<!--
CO_OP_TRANSLATOR_METADATA:
{
  "original_hash": "3dbbf568625b1ee04b354c2dc81d3248",
  "translation_date": "2025-09-12T14:27:26+00:00",
  "source_file": "md/02.Application/02.Code/Phi3/VSCodeExt/HOL/Apple/02.PromptflowWithMLX.md",
  "language_code": "lt"
}
-->
# **Laboratorinis darbas 2 - Paleiskite Prompt flow su Phi-3-mini AIPC**

## **Kas yra Prompt flow**

Prompt flow – tai įrankių rinkinys, skirtas supaprastinti visą LLM pagrįstų AI programų kūrimo ciklą: nuo idėjų generavimo, prototipų kūrimo, testavimo, vertinimo iki diegimo ir stebėjimo gamyboje. Jis palengvina promptų kūrimą ir leidžia kurti aukštos kokybės LLM programas.

Naudodami Prompt flow, galėsite:

- Kurti srautus, kurie sujungia LLM, promptus, Python kodą ir kitus įrankius į vykdomą darbo eigą.

- Lengvai derinti ir tobulinti savo srautus, ypač sąveiką su LLM.

- Vertinti savo srautus, skaičiuoti kokybės ir našumo rodiklius naudojant didesnius duomenų rinkinius.

- Integruoti testavimą ir vertinimą į savo CI/CD sistemą, kad užtikrintumėte srauto kokybę.

- Diegti savo srautus pasirinktoje aptarnavimo platformoje arba lengvai integruoti į savo programos kodą.

- (Pasirinktinai, bet labai rekomenduojama) Bendradarbiauti su komanda, naudojant Prompt flow debesų versiją Azure AI.



## **Kodo generavimo srautų kūrimas Apple Silicon įrenginiuose**

***Pastaba***: Jei dar nebaigėte aplinkos diegimo, apsilankykite [Lab 0 - Diegimas](./01.Installations.md)

1. Atidarykite Prompt flow plėtinį Visual Studio Code ir sukurkite tuščią srauto projektą.

![create](../../../../../../../../../imgs/02/vscodeext/pf_create.png)

2. Pridėkite įvesties ir išvesties parametrus bei Python kodą kaip naują srautą.

![flow](../../../../../../../../../imgs/02/vscodeext/pf_flow.png)

Galite remtis šia struktūra (flow.dag.yaml), kad sukurtumėte savo srautą.

```yaml

inputs:
  prompt:
    type: string
    default: Write python code for Fibonacci serie. Please use markdown as output
outputs:
  result:
    type: string
    reference: ${gen_code_by_phi3.output}
nodes:
- name: gen_code_by_phi3
  type: python
  source:
    type: code
    path: gen_code_by_phi3.py
  inputs:
    prompt: ${inputs.prompt}


```

3. Kvantizuokite phi-3-mini

Norime geriau paleisti SLM vietiniuose įrenginiuose. Paprastai modelį kvantizuojame (INT4, FP16, FP32).

```bash

python -m mlx_lm.convert --hf-path microsoft/Phi-3-mini-4k-instruct

```

**Pastaba:** numatytasis aplankas yra mlx_model.

4. Pridėkite kodą į ***Chat_With_Phi3.py***.

```python


from promptflow import tool

from mlx_lm import load, generate


# The inputs section will change based on the arguments of the tool function, after you save the code
# Adding type to arguments and return value will help the system show the types properly
# Please update the function name/signature per need
@tool
def my_python_tool(prompt: str) -> str:

    model_id = './mlx_model_phi3_mini'

    model, tokenizer = load(model_id)

    # <|user|>\nWrite python code for Fibonacci serie. Please use markdown as output<|end|>\n<|assistant|>

    response = generate(model, tokenizer, prompt="<|user|>\n" + prompt  + "<|end|>\n<|assistant|>", max_tokens=2048, verbose=True)

    return response


```

4. Galite testuoti srautą naudodami Debug arba Run, kad patikrintumėte, ar generavimo kodas veikia tinkamai.

![RUN](../../../../../../../../../imgs/02/vscodeext/pf_run.png)

5. Paleiskite srautą kaip vystymo API terminale.

```

pf flow serve --source ./ --port 8080 --host localhost   

```

Galite jį testuoti naudodami Postman / Thunder Client.


### **Pastabos**

1. Pirmasis paleidimas užtrunka ilgai. Rekomenduojama atsisiųsti phi-3 modelį naudojant Hugging Face CLI.

2. Atsižvelgiant į ribotą Intel NPU skaičiavimo galią, rekomenduojama naudoti Phi-3-mini-4k-instruct.

3. Naudojame Intel NPU pagreitį INT4 konversijai kvantizuoti, tačiau jei paleisite paslaugą iš naujo, turite ištrinti talpyklą ir nc_workshop aplankus.



## **Resursai**

1. Sužinokite apie Promptflow [https://microsoft.github.io/promptflow/](https://microsoft.github.io/promptflow/)

2. Sužinokite apie Intel NPU pagreitį [https://github.com/intel/intel-npu-acceleration-library](https://github.com/intel/intel-npu-acceleration-library)

3. Pavyzdinis kodas, atsisiųskite [Vietinio NPU agento pavyzdinį kodą](../../../../../../../../../code/07.Lab/01/AIPC/local-npu-agent)

---

**Atsakomybės apribojimas**:  
Šis dokumentas buvo išverstas naudojant AI vertimo paslaugą [Co-op Translator](https://github.com/Azure/co-op-translator). Nors siekiame tikslumo, prašome atkreipti dėmesį, kad automatiniai vertimai gali turėti klaidų ar netikslumų. Originalus dokumentas jo gimtąja kalba turėtų būti laikomas autoritetingu šaltiniu. Kritinei informacijai rekomenduojama profesionali žmogaus vertimo paslauga. Mes neprisiimame atsakomybės už nesusipratimus ar klaidingus interpretavimus, atsiradusius dėl šio vertimo naudojimo.