<!--
CO_OP_TRANSLATOR_METADATA:
{
  "original_hash": "c98217bb3eff6c24e97b104b21632fd0",
  "translation_date": "2025-07-17T03:17:44+00:00",
  "source_file": "md/02.Application/01.TextAndChat/Phi4/ChatWithPhi4ONNX/README.md",
  "language_code": "sv"
}
-->
# **Chatta med Phi-4-mini ONNX**

***ONNX*** är ett öppet format som är utformat för att representera maskininlärningsmodeller. ONNX definierar en gemensam uppsättning operatorer – byggstenarna i maskininlärnings- och djupinlärningsmodeller – samt ett gemensamt filformat för att möjliggöra för AI-utvecklare att använda modeller med olika ramverk, verktyg, körmiljöer och kompilatorer.

Vi hoppas kunna distribuera generativa AI-modeller på edge-enheter och använda dem i miljöer med begränsad beräkningskraft eller offline. Nu kan vi uppnå detta mål genom att konvertera modellen på ett kvantiserat sätt. Vi kan konvertera den kvantiserade modellen till GGUF- eller ONNX-format.

Microsoft Olive kan hjälpa dig att konvertera SLM till kvantiserat ONNX-format. Metoden för att genomföra modellkonverteringen är mycket enkel.

**Installera Microsoft Olive SDK**


```bash

pip install olive-ai

pip install transformers

```

**Konvertera CPU ONNX-stöd**

```bash

olive auto-opt --model_name_or_path Your Phi-4-mini location --output_path Your onnx ouput location --device cpu --provider CPUExecutionProvider --precision int4 --use_model_builder --log_level 1

```

***Notera*** att detta exempel använder CPU


### **Inferens av Phi-4-mini ONNX-modell med ONNX Runtime GenAI**

- **Installera ONNX Runtime GenAI**

```bash

pip install --pre onnxruntime-genai

```

- **Python-kod**

*Detta är ONNX Runtime GenAI version 0.5.2*

```python

import onnxruntime_genai as og
import numpy as np
import os


model_folder = "Your Phi-4-mini-onnx-cpu-int4 location"


model = og.Model(model_folder)


tokenizer = og.Tokenizer(model)
tokenizer_stream = tokenizer.create_stream()


search_options = {}
search_options['max_length'] = 2048
search_options['past_present_share_buffer'] = False


chat_template = "<|user|>\n{input}</s>\n<|assistant|>"


text = """Can you introduce yourself"""


prompt = f'{chat_template.format(input=text)}'


input_tokens = tokenizer.encode(prompt)


params = og.GeneratorParams(model)


params.set_search_options(**search_options)
params.input_ids = input_tokens


generator = og.Generator(model, params)


while not generator.is_done():
      generator.compute_logits()
      generator.generate_next_token()

      new_token = generator.get_next_tokens()[0]
      print(tokenizer_stream.decode(new_token), end='', flush=True)

```


*Detta är ONNX Runtime GenAI version 0.6.0*

```python

import onnxruntime_genai as og
import numpy as np
import os
import time
import psutil

model_folder = "Your Phi-4-mini-onnx model path"

model = og.Model(model_folder)

tokenizer = og.Tokenizer(model)
tokenizer_stream = tokenizer.create_stream()

search_options = {}
search_options['max_length'] = 1024
search_options['past_present_share_buffer'] = False

chat_template = "<|user|>{input}<|assistant|>"

text = """can you introduce yourself"""

prompt = f'{chat_template.format(input=text)}'

input_tokens = tokenizer.encode(prompt)

params = og.GeneratorParams(model)

params.set_search_options(**search_options)

generator = og.Generator(model, params)

generator.append_tokens(input_tokens)

while not generator.is_done():
      generator.generate_next_token()

      new_token = generator.get_next_tokens()[0]
      token_text = tokenizer.decode(new_token)
      # print(tokenizer_stream.decode(new_token), end='', flush=True)
      if token_count == 0:
        first_token_time = time.time()
        first_response_latency = first_token_time - start_time
        print(f"firstly token delpay: {first_response_latency:.4f} s")

      print(token_text, end='', flush=True)
      token_count += 1

```

**Ansvarsfriskrivning**:  
Detta dokument har översatts med hjälp av AI-översättningstjänsten [Co-op Translator](https://github.com/Azure/co-op-translator). Även om vi strävar efter noggrannhet, vänligen observera att automatiska översättningar kan innehålla fel eller brister. Det ursprungliga dokumentet på dess modersmål ska betraktas som den auktoritativa källan. För kritisk information rekommenderas professionell mänsklig översättning. Vi ansvarar inte för några missförstånd eller feltolkningar som uppstår vid användning av denna översättning.