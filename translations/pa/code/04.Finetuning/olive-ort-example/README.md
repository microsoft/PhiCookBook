# Olive рижрйА ри╡ри░ридрйЛриВ риХри░риХрйЗ Phi3 риирйВрй░ рилри╛риИрии-риЯри┐риКрии риХри░рйЛ

риЗри╕ риЙрижри╛ри╣ри░рии ри╡ри┐рй▒риЪ ридрйБри╕рйАриВ Olive рижрйА ри╡ри░ридрйЛриВ риХри░риХрйЗ:

1. риЗрй▒риХ LoRA риРрибри╛рикриЯри░ риирйВрй░ рилри╛риИрии-риЯри┐риКрии риХри░рйЛ ридри╛риВ риЬрйЛ ри╡ри╛риХри╛риВ риирйВрй░ Sad, Joy, Fear, Surprise ри╡ри┐рй▒риЪ ри╡ри░риЧрйАриХрйНри░ри┐рид риХрйАридри╛ риЬри╛ ри╕риХрйЗред
1. риРрибри╛рикриЯри░ рижрйЗ ри╡риЬри╝рии римрйЗри╕ риори╛рибри▓ ри╡ри┐рй▒риЪ риори┐ри▓ри╛риУред
1. риори╛рибри▓ риирйВрй░ `int4` ри╡ри┐рй▒риЪ Optimize риЕридрйЗ Quantize риХри░рйЛред

риЕри╕рйАриВ ридрйБри╣ри╛риирйВрй░ рижри┐риЦри╛ри╡ри╛риВриЧрйЗ риХри┐ риХри┐ри╡рйЗриВ ONNX Runtime (ORT) Generate API рижрйА ри╡ри░ридрйЛриВ риХри░риХрйЗ рилри╛риИрии-риЯри┐риКрии риХрйАридри╛ риори╛рибри▓ риЗрй░рилри░рйИриВри╕ риХрйАридри╛ риЬри╛ ри╕риХрижри╛ ри╣рйИред

> **тЪая╕П рилри╛риИрии-риЯри┐риКриири┐рй░риЧ ри▓риИ, ридрйБри╣ри╛рибрйЗ риХрйЛри▓ риЗрй▒риХ рипрйЛриЧ GPU ри╣рйЛригри╛ риЬри░рйВри░рйА ри╣рйИ - риЙрижри╛ри╣ри░рии ри╡риЬрйЛриВ, A10, V100, A100ред**

## ЁЯТ╛ риЗрй░ри╕риЯри╛ри▓ риХри░рйЛ

риири╡ри╛риВ Python ри╡ри░риЪрйБриЕри▓ ри╡ри╛ридри╛ри╡ри░риг римригри╛риУ (риЙрижри╛ри╣ри░рии ри╡риЬрйЛриВ, `conda` рижрйА ри╡ри░ридрйЛриВ риХри░риХрйЗ):

```bash
conda create -n olive-ai python=3.11
conda activate olive-ai
```

рилри┐ри░, Olive риЕридрйЗ рилри╛риИрии-риЯри┐риКриири┐рй░риЧ ри╡ри░риХрилри▓рйЛ ри▓риИ ри▓рйЛрйЬрйАриВрижрйЗ рибри┐рикрйИриВрибрйИриВри╕рйАриЬри╝ риЗрй░ри╕риЯри╛ри▓ риХри░рйЛ:

```bash
cd Phi-3CookBook/code/04.Finetuning/olive-ort-example
pip install olive-ai[gpu]
pip install -r requirements.txt
```

## ЁЯзк Olive рижрйА ри╡ри░ридрйЛриВ риХри░риХрйЗ Phi3 риирйВрй░ рилри╛риИрии-риЯри┐риКрии риХри░рйЛ
[Olive configuration file](../../../../../code/04.Finetuning/olive-ort-example/phrase-classification.json) ри╡ри┐рй▒риЪ риЗрй▒риХ *workflow* ри╣рйИ риЬри┐ри╕ ри╡ри┐рй▒риЪ ри╣рйЗриари╛риВ рижри┐рй▒ридрйЗ *passes* ри╣рии:

Phi3 -> LoRA -> MergeAdapterWeights -> ModelBuilder

риЙрй▒риЪ-ри╕ридри░ 'ридрйЗ, риЗри╣ workflow риЗри╣ риХри░рйЗриЧри╛:

1. Phi3 риирйВрй░ (150 риХрижриори╛риВ ри▓риИ, риЬри┐ри╕риирйВрй░ ридрйБри╕рйАриВ римрижри▓ ри╕риХрижрйЗ ри╣рйЛ) [dataset/data-classification.json](../../../../../code/04.Finetuning/olive-ort-example/dataset/dataset-classification.json) рибрйЗриЯри╛ рижрйА ри╡ри░ридрйЛриВ риХри░риХрйЗ рилри╛риИрии-риЯри┐риКрии риХри░рйЛред
1. LoRA риРрибри╛рикриЯри░ рижрйЗ ри╡риЬри╝рии римрйЗри╕ риори╛рибри▓ ри╡ри┐рй▒риЪ риори┐ри▓ри╛риУред риЗри╕ риири╛ри▓ ридрйБри╣ри╛рибрйЗ риХрйЛри▓ ONNX рилри╛ри░риорйИриЯ ри╡ри┐рй▒риЪ риЗрй▒риХ риЗриХрй▒ри▓ри╛ риори╛рибри▓ риЖри░риЯрйАрилрйИриХриЯ ри╣рйЛри╡рйЗриЧри╛ред
1. Model Builder риори╛рибри▓ риирйВрй░ ONNX ри░риириЯри╛риИрио ри▓риИ Optimize риХри░рйЗриЧри╛ риЕридрйЗ риори╛рибри▓ риирйВрй░ `int4` ри╡ри┐рй▒риЪ Quantize риХри░рйЗриЧри╛ред

ри╡ри░риХрилри▓рйЛ риЪри▓ри╛риЙриг ри▓риИ, риЗри╣ риХриори╛риВриб риЪри▓ри╛риУ:

```bash
olive run --config phrase-classification.json
```

риЬрижрйЛриВ Olive риорйБриХрй░риори▓ ри╣рйЛ риЬри╛ри╡рйЗ, ридрйБри╣ри╛рибри╛ Optimize риХрйАридри╛ ри╣рйЛриЗриЖ `int4` рилри╛риИрии-риЯри┐риКрии риХрйАридри╛ Phi3 риори╛рибри▓ риЗри╕ риери╛риВ риЙрикри▓римриз ри╣рйЛри╡рйЗриЧри╛: `code/04.Finetuning/olive-ort-example/models/lora-merge-mb/gpu-cuda_model`ред

## ЁЯзСтАНЁЯТ╗ рилри╛риИрии-риЯри┐риКрии риХрйАридри╛ Phi3 риЖрикригрйЗ риРрикри▓рйАриХрйЗри╕ри╝рии ри╡ри┐рй▒риЪ ри╕ри╝ри╛риори▓ риХри░рйЛ

риРрик риЪри▓ри╛риЙриг ри▓риИ:

```bash
python app/app.py --phrase "cricket is a wonderful sport!" --model-path models/lora-merge-mb/gpu-cuda_model
```

риЗри╕ рижри╛ риЬри╡ри╛рим ри╡ри╛риХ рижри╛ риЗрй▒риХ ри╕ри╝римриж ри╡ри░риЧрйАриХри░рии ри╣рйЛри╡рйЗриЧри╛ (Sad/Joy/Fear/Surprise)ред

**риЕри╕ри╡рйАриХри╛ри░рйЛрикриг**:  
риЗри╣ рижри╕ридри╛ри╡рйЗриЬри╝ AI риЕриирйБри╡ри╛риж ри╕рйЗри╡ри╛ [Co-op Translator](https://github.com/Azure/co-op-translator) рижрйА ри╡ри░ридрйЛриВ риХри░риХрйЗ риЕриирйБри╡ри╛рижри┐рид риХрйАридри╛ риЧри┐риЖ ри╣рйИред риЬрижрйЛриВ риХри┐ риЕри╕рйАриВ ри╕ри╣рйАриЕрид ри▓риИ риХрйЛри╕ри╝ри┐ри╕ри╝ риХри░рижрйЗ ри╣ри╛риВ, риХри┐ри░рикри╛ риХри░риХрйЗ ризри┐риЖрии ри░рй▒риЦрйЛ риХри┐ ри╕ри╡рйИриЪри╛ри▓ри┐рид риЕриирйБри╡ри╛рижри╛риВ ри╡ри┐рй▒риЪ риЧри▓ридрйАриЖриВ риЬри╛риВ риЕри╕риори░риеридри╛ри╡ри╛риВ ри╣рйЛ ри╕риХрижрйАриЖриВ ри╣рииред риорйВри▓ рижри╕ридри╛ри╡рйЗриЬри╝ риЖрикригрйА риорйВри▓ ринри╛ри╕ри╝ри╛ ри╡ри┐рй▒риЪ рикрйНри░риори╛ригри┐риХ ри╕ри░рйЛрид риорй░риири┐риЖ риЬри╛ригри╛ риЪри╛ри╣рйАрижри╛ ри╣рйИред риори╣рй▒ридри╡рикрйВри░рии риЬри╛ригриХри╛ри░рйА ри▓риИ, рикрйЗри╕ри╝рйЗри╡ри░ риориирйБрй▒риЦрйА риЕриирйБри╡ри╛риж рижрйА ри╕ри┐рилри╛ри░ри╕ри╝ риХрйАридрйА риЬри╛риВрижрйА ри╣рйИред риЗри╕ риЕриирйБри╡ри╛риж рижрйА ри╡ри░ридрйЛриВ ридрйЛриВ риЙридрикрй░рии риХри┐ри╕рйЗ ри╡рйА риЧри▓ридрилри╣ри┐риорйА риЬри╛риВ риЧри▓рид ри╡ри┐риЖриЦри┐риЖ ри▓риИ риЕри╕рйАриВ риЬри╝ри┐рй░риорйЗри╡ри╛ри░ риири╣рйАриВ ри╣ри╛риВред