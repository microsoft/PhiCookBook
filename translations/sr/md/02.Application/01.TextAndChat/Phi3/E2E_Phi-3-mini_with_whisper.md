# Интерактивни Phi 3 Mini 4K Инструкт Чатбот са Whisper

## Преглед

Интерактивни Phi 3 Mini 4K Инструкт Чатбот је алат који корисницима омогућава интеракцију са Microsoft Phi 3 Mini 4K инструкт демоом користећи текстуални или аудио унос. Чатбот се може користити за различите задатке, као што су превод, временске информације и опште прикупљање информација.

### Почетак рада

Да бисте користили овај чатбот, једноставно следите ове инструкције:

1. Отворите нови [E2E_Phi-3-mini-4k-instruct-Whispser_Demo.ipynb](https://github.com/microsoft/Phi-3CookBook/blob/main/code/06.E2E/E2E_Phi-3-mini-4k-instruct-Whispser_Demo.ipynb)
2. У главном прозору нотебоока видећете интерфејс за ћаскање са пољем за унос текста и дугметом „Send“.
3. Да бисте користили текстуални чатбот, једноставно унесите вашу поруку у поље за унос текста и кликните на дугме „Send“. Чатбот ће одговорити аудио фајлом који се може репродуковати директно из нотебоока.

**Напомена**: Овај алат захтева GPU и приступ Microsoft Phi-3 и OpenAI Whisper моделима, који се користе за препознавање говора и превођење.

### Захтеви за GPU

Да бисте покренули овај демо потребно вам је 12 ГБ меморије на GPU-у.

Захтеви за меморију приликом покретања **Microsoft-Phi-3-Mini-4K instruct** демоа на GPU-у зависе од више фактора, као што су величина улазних података (аудио или текст), језик коришћен за превод, брзина модела и расположива меморија на GPU-у.

Уопштено, Whisper модел је дизајниран да ради на GPU-овима. Препоручена минимална количина GPU меморије за покретање Whisper модела је 8 ГБ, али може поднети и веће количине меморије ако је потребно.

Важно је напоменути да покретање великог броја података или великих количина захтева на модел може захтевати више GPU меморије и/или може изазвати проблеме са перформансама. Препоручује се да тестирате свој случај употребе са различитим конфигурацијама и пратите употребу меморије како бисте одредили оптимална подешавања за ваше специфичне потребе.

## E2E пример за Интерактивни Phi 3 Mini 4K Инструкт Чатбот са Whisper

Јупитер нотебоок под називом [Интерактивни Phi 3 Mini 4K Инструкт Чатбот са Whisper](https://github.com/microsoft/Phi-3CookBook/blob/main/code/06.E2E/E2E_Phi-3-mini-4k-instruct-Whispser_Demo.ipynb) демонстрира како се користи Microsoft Phi 3 Mini 4K инструкт демо за генерисање текста из аудио или писаног уноса. Нотебоок дефинише неколико функција:

1. `tts_file_name(text)`: Ова функција генерише име фајла на основу улазног текста за чување генерисаног аудио фајла.
1. `edge_free_tts(chunks_list,speed,voice_name,save_path)`: Ова функција користи Edge TTS API за генерисање аудио фајла из листе сегмената улазног текста. Улазни параметри су листа сегмената, брзина говора, име гласа и путања за чување генерисаног аудио фајла.
1. `talk(input_text)`: Ова функција генерише аудио фајл коришћењем Edge TTS API-а и чува га са насумичним именом у директоријуму /content/audio. Улазни параметар је текст који се претвара у говор.
1. `run_text_prompt(message, chat_history)`: Ова функција користи Microsoft Phi 3 Mini 4K инструкт демо за генерисање аудио фајла из улаза поруке и додаје га у историју ћаскања.
1. `run_audio_prompt(audio, chat_history)`: Ова функција претвара аудио фајл у текст користећи Whisper модел API и прослеђује га функцији `run_text_prompt()`.
1. Код покреће Градио апликацију која омогућава корисницима интеракцију са Phi 3 Mini 4K инструкт демоом било путем куцања порука или отпремања аудио фајлова. Излаз се приказује као текстуална порука унутар апликације.

## Решавање проблема

Инсталирање Cuda GPU драјвера

1. Уверите се да су ваше Линукс апликације ажурне

    ```bash
    sudo apt update
    ```

1. Инсталирајте Cuda драјвере

    ```bash
    sudo apt install nvidia-cuda-toolkit
    ```

1. Региструјте локацију CUDA драјвера

    ```bash
    echo /usr/lib64-nvidia/ >/etc/ld.so.conf.d/libcuda.conf; ldconfig
    ```

1. Провера величине Nvidia GPU меморије (Потребно 12GB GPU меморије)

    ```bash
    nvidia-smi
    ```

1. Празан кеш: Ако користите PyTorch, можете позвати torch.cuda.empty_cache() да ослободите сву неискоришћену кеширану меморију тако да је могу користити друге GPU апликације

    ```python
    torch.cuda.empty_cache() 
    ```

1. Провера Nvidia Cuda

    ```bash
    nvcc --version
    ```

1. Извршите следеће задатке да бисте креирали Hugging Face token.

    - Идите на [Hugging Face Token Settings page](https://huggingface.co/settings/tokens?WT.mc_id=aiml-137032-kinfeylo).
    - Изаберите **New token**.
    - Унесите име пројекта које желите да користите.
    - Изаберите **Type** као **Write**.

> [!NOTE]
>
> Ако наиђете на следећу грешку:
>
> ```bash
> /sbin/ldconfig.real: Can't create temporary cache file /etc/ld.so.cache~: Permission denied 
> ```
>
> Да бисте решили ово, укуцајте следећу команду у вашем терминалу.
>
> ```bash
> sudo ldconfig
> ```

---

<!-- CO-OP TRANSLATOR DISCLAIMER START -->
**Изјава о одрицању одговорности**:  
Овaј документ је преведен уз помоћ услуге за превођење помоћу вештачке интелигенције [Co-op Translator](https://github.com/Azure/co-op-translator). Иако тежимо прецизности, молимо вас да имате у виду да аутоматизовани преводи могу да садрже грешке или нетачности. Оригинални документ на изворном језику треба сматрати ауторитетним извором. За критичне информације препоручује се професионални превод од стране људског преводиоца. Нисмо одговорни за било каква неспоразума или погрешна тумачења која могу настати коришћењем овог превода.
<!-- CO-OP TRANSLATOR DISCLAIMER END -->